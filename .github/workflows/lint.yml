on:
    pull_request:
      branches:
        - master
      types: [opened, synchronize]

name: check lint or do lint

jobs:
    check-lint:
        name: lint
        runs-on: ubuntu-latest
        steps: 
            - name: checkout
              uses: actions/checkout@v4
            - name: install dependencies
              run: npm install
            - name: lint
              run: npm run fix
            - name: check diff
              id: check-diff
              run: |
                set +e
                git diff --exit-code
                exitcode="$?"
                echo "exitcode=$exitcode" >> $GITHUB_OUTPUT
            - if: steps.check-diff.outputs.exitcode == 0
              name: comment
              env: 
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                gh pr comment ${{ github.event.pull_request.number }} --body ":tada: Lint passed!"
            - if: steps.check-diff.outputs.exitcode != 0
              name: comment
              env: 
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                  git status
                  git config --global user.email "github-actions@github.com"
                  git config --global user.name "github-actions"
                  git add .
                  git commit -m "lint"
                  git push
                  gh pr comment ${{ github.event.pull_request.number }} --body "lint failed"
            # - if: steps.lint.outputs.exitcode == 0
            #   name: commit lint
            #   run: |
            - name: log lint result
              run: |
                echo "lint result: ${{ steps.check-diff.outputs.exitcode }}"
